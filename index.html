<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HTML Video Player</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>  
</head>
<body>

  <button id="upload_widget" class="cloudinary-button">Upload files</button>

  <p  id="demo"></p>
  <img id="videoinfo"></img>

  <div class="player">
    <canvas class="canvas" id="video_canvas"></canvas>
    <video class="player__video viewer" src="652333414.mp4"></video>

    <div class="player__controls">
      <div class="progress">
        <div class="progress__filled"></div>
      </div>
      <button class="player__button toggle" title="Toggle Play">►</button>
      <input type="range" name="volume" class="player__slider" min="0" max="1" step="0.05" value="1">
      <input type="range" name="playbackRate" class="player__slider" min="0.5" max="2" step="0.1" value="1">
      <button data-skip="-10" class="player__button">« 10s</button>
      <button data-skip="25" class="player__button">25s »</button>
    </div>
  </div>
  <div class="toolbar">
    <button onclick="clearCanvas()">Clear</button>
  </div>
  <script 
    src="scripts.js"></script>

<script type="text/javascript">

document.cookie="name=john";

function parseArray(array) {
  finalarray = []
  if (urlNumber === 1) {
    finalarray.push(JSON.parse(array));
  } else if (urlNumber > 1) {
    for (var i = 0; i < array.length;  i++) {
      finalarray.push(JSON.parse(`${array[i]}`));
    }
  }    
  return finalarray;
}  


function findData() {
  if (urlNumber === 1) {
    console.log("1st");
    var videoArray = previousCookie.substring(4);
  } else if (urlNumber > 1) {
    console.log("2nd");
    var videoArray = (previousCookie.substring(4)).split(', '); 
  }
   return parseArray(videoArray);
}


//Begin on Page Load, Find Data from previous cookie. 
var previousCookie = document.cookie.split('; ').find(row => row.startsWith('url'));
if (previousCookie != undefined) {
  var urlNumber = previousCookie.match(/"url":/g).length;
  console.log("# of Items", urlNumber);
} else {
  urlNumber = 0;
}




//Turns Cookie Data into Object
const data = findData();
console.log("PREVIOUS:", previousCookie);
console.log("DATA:", data);

//Cloudinary Widget
  var myWidget = cloudinary.createUploadWidget({
  cloudName: 'dzi01cqjq', 
  uploadPreset: 'w5ixakcl'}, (error, result) => { 
    if (!error && result && result.event === "success") {
      if (previousCookie === undefined) {
        //First Upload
        document.cookie = "url=" + JSON.stringify(result.info);
      } else if (previousCookie != undefined) { 
        //Subsequent uploads
        var newCookie = previousCookie + ", " + JSON.stringify(result.info);
        document.cookie = newCookie;
        console.log("Added to original cookies");
        
      }
      console.log('Done! Here is the image info: ', result.info); 
      console.log('Cookie is:', document.cookie);
    }
  })

document.getElementById("upload_widget").addEventListener("click", function(){
    myWidget.open();
}, false);

//render data on html page
if (data == true) {
var cookieKeys = {
  "url": data[0].url,
  "thumbnail": data[0].thumbnail_url,
  }
  document.getElementById("videoinfo").src = cookieKeys.thumbnail;
}

var readCookie = document.cookie.split(';').map(cookie => cookie.split('='));
document.getElementById("demo").innerHTML = readCookie;

</script>
</script>


    
  
</body>
</html>